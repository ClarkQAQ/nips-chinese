NIP-71
======

视频事件
------------

`草案` `可选`

本规范定义了表示外部托管内容专用帖子的_视频_事件。

与附带视频的 `kind:1` 事件不同，视频事件旨在包含有关主题媒体的所有附加元数据，并在视频特定客户端而非一般微博客户端中显示。这种想法是让这种事件在类似 Netflix、YouTube 或 TikTok 的 nostr 客户端中被引用，其中视频本身是体验的中心。

## 视频事件

有两种类型的视频事件由不同种类表示：_普通_和_短_视频事件。这是为了让客户端能够迎合每种类型，因为较长的、主要是水平（横向）视频的观看体验通常与短形式的、主要是垂直（纵向）视频（"故事"、"卷轴"、"短片"等）不同。

除了骑士精神和常识外，没有什么阻止_短_视频变长，或_普通_视频变垂直，这可能是合理的也可能不合理，这主要是风格质量差异，而不是实际原始大小的问题。

#### 格式

格式使用_普通_视频的_常规事件_种类 `21` 和_短_视频的 `22`。

这些事件的 `.content` 是视频内容的摘要或描述。

视频信息的主要来源是在 [NIP-92](92_ZH.md) 中定义的 `imeta` 标签

每个 `imeta` 标签可以通过 `dim` 和 `m` 属性用于指定视频的变体。

示例：
```json
[
  ["imeta",
    "dim 1920x1080",
    "url https://myvideo.com/1080/12345.mp4",
    "x 3093509d1e0bc604ff60cb9286f4cd7c781553bc8991937befaacfdc28ec5cdc",
    "m video/mp4",
    "image https://myvideo.com/1080/12345.jpg",
    "image https://myotherserver.com/1080/12345.jpg",
    "fallback https://myotherserver.com/1080/12345.mp4",
    "fallback https://andanotherserver.com/1080/12345.mp4",
    "service nip96",
  ],
  ["imeta",
    "dim 1280x720",
    "url https://myvideo.com/720/12345.mp4",
    "x e1d4f808dae475ed32fb23ce52ef8ac82e3cc760702fca10d62d382d2da3697d",
    "m video/mp4",
    "image https://myvideo.com/720/12345.jpg",
    "image https://myotherserver.com/720/12345.jpg",
    "fallback https://myotherserver.com/720/12345.mp4",
    "fallback https://andanotherserver.com/720/12345.mp4",
    "service nip96",
  ],
  ["imeta",
    "dim 1280x720",
    "url https://myvideo.com/720/12345.m3u8",
    "x 704e720af2697f5d6a198ad377789d462054b6e8d790f8a3903afbc1e044014f",
    "m application/x-mpegURL",
    "image https://myvideo.com/720/12345.jpg",
    "image https://myotherserver.com/720/12345.jpg",
    "fallback https://myotherserver.com/720/12345.m3u8",
    "fallback https://andanotherserver.com/720/12345.m3u8",
    "service nip96",
  ],
]
```

其中 `url` 是主服务器 URL，`fallback` 是托管相同文件的其他服务器，`url` 和 `fallback` 应该同等权重，建议客户端使用任何提供的视频 URL。

`image` 标签包含预览图像（相同分辨率）。可以使用多个 `image` 标签以与 `fallback` 用于 `url` 相同的方式指定备用副本。

另外可以包含 `service nip96` 以允许客户端搜索作者的 NIP-96 服务器列表来使用哈希找到文件。

### 其他标签：
* `title`（必需）视频标题
* `published_at`，视频首次发布的 unix 秒时间戳（字符串化）
* `duration`（可选）视频持续时间（秒）
* `text-track`（可选，重复）指向视频 WebVTT 文件的链接，补充信息类型（字幕/副标题/章节/元数据），可选语言代码
* `content-warning`（可选）关于 NSFW 视频内容的警告
* `alt`（可选）无障碍描述
* `segment`（可选，重复）格式为 `HH:MM:SS.sss` 的开始时间戳，格式为 `HH:MM:SS.sss` 的结束时间戳，章节/段落标题，章节缩略图 URL
* `t`（可选，重复）用于分类视频的标签
* `p`（可选，重复）视频参与者的 32 字节十六进制公钥，可选推荐中继器 URL
* `r`（可选，重复）对网页的引用/链接

```jsonc
{
  "id": "<序列化事件数据的 32 字节小写十六进制编码 SHA-256>",
  "pubkey": "<事件创建者的 32 字节小写十六进制编码公钥>",
  "created_at": <以秒为单位的 Unix 时间戳>,
  "kind": 21 | 22,
  "content": "<视频摘要/描述>",
  "tags": [
    ["title", "<视频标题>"],
    ["published_at", "<unix 时间戳>"],
    ["alt", "<描述>"],

    // 视频数据
    ["imeta",
      "dim 1920x1080",
      "url https://myvideo.com/1080/12345.mp4",
      "x 3093509d1e0bc604ff60cb9286f4cd7c781553bc8991937befaacfdc28ec5cdc",
      "m video/mp4",
      "image https://myvideo.com/1080/12345.jpg",
      "image https://myotherserver.com/1080/12345.jpg",
      "fallback https://myotherserver.com/1080/12345.mp4",
      "fallback https://andanotherserver.com/1080/12345.mp4",
      "service nip96",
    ],

    ["duration", "<视频持续时间（秒）>"],
    ["text-track", "<编码的 `kind 6000` 事件>", "<推荐中继器 URL>"],
    ["content-warning", "<原因>"],
    ["segment", <开始>, <结束>, "<标题>", "<缩略图 URL>"],

    // 参与者
    ["p", "<公钥的 32 字节十六进制>", "<可选推荐中继器 URL>"],
    ["p", "<公钥的 32 字节十六进制>", "<可选推荐中继器 URL>"],

    // 标签
    ["t", "<标签>"],
    ["t", "<标签>"],

    // 引用链接
    ["r", "<URL>"],
    ["r", "<URL>"]
  ]
}
```
