NIP-27
======

文本笔记引用
--------------------

`草案` `可选`

本文档标准化了客户端对在任何在其 `.content` 中具有可读文本的事件（如种类 1 和 30023）的 `.content` 内其他事件和档案的内联引用的处理。

创建事件时，客户端应该使用 [NIP-21](21_ZH.md) 代码在 `.content` 中间包含对其他档案和其他事件的提及，如 `nostr:nprofile1qqsw3dy8cpu...6x2argwghx6egsqstvg`。

为每个引用包含 [NIP-18](18_ZH.md) 的引用标签（`["q", "<事件ID> 或 <事件地址>", "<中继器URL>", "<如果是常规事件的公钥>"]`）是可选的，客户端应该在希望被提及的档案收到提及通知时，或者希望被引用的事件将其提及识别为回复时这样做。

接收到在其 `.content` 中有此类 `nostr:...` 提及的事件的读者客户端可以在过程中进行任何所需的上下文增强（例如，链接到档案或显示提及事件内容的预览）。如果将此类提及转换为链接，它们可以成为内部链接、[NIP-21](21_ZH.md) 链接或指向将处理这些引用的 Web 客户端的直接链接。

---

## 档案提及过程示例

假设 Bob 正在具有搜索和自动完成功能的客户端中写笔记，当他们写字符 `@` 时会触发该功能。

当 Bob 输入 `"hello @mat"` 时，客户端将提示他使用 [mattn 的档案](https://njump.me/npub1937vv2nf06360qn9y8el6d8sevnndy7tuh5nzre4gj05xc32tnwqauhaj6) 进行自动完成，显示图片和名称。

Bob 按下"回车"，现在他看到他输入的笔记为 `"hello @mattn"`，`@mattn` 被突出显示，表示这是一个提及。然而，在内部，事件看起来像这样：

```json
{
  "content": "hello nostr:nprofile1qqszclxx9f5haga8sfjjrulaxncvkfekj097t6f3pu65f86rvg49ehqj6f9dh",
  "created_at": 1679790774,
  "id": "f39e9b451a73d62abc5016cffdd294b1a904e2f34536a208874fe5e22bbd47cf",
  "kind": 1,
  "pubkey": "79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798",
  "sig": "f8c8bab1b90cc3d2ae1ad999e6af8af449ad8bb4edf64807386493163e29162b5852a796a8f474d6b1001cddbaac0de4392838574f5366f03cc94cf5dfb43f4d",
  "tags": [
    [
      "p",
      "2c7cc62a697ea3a7826521f3fd34f0cb273693cbe5e9310f35449f43622a5cdc"
    ]
  ]
}
```

（或者，提及可能是 `nostr:npub1...` URL。）

Bob 发布此事件后，Carol 看到它时，她的客户端最初会按原样显示 `.content`，但稍后会解析 `.content` 并看到其中有 `nostr:` URL，解码它，从中提取公钥（可能还有中继器提示），从其内部数据库或中继器获取该档案，然后用名称 `@mattn` 替换完整 URL，并链接到该档案的内部页面视图。

## 冗长且可能不必要的考虑

- 上面的示例非常具体，但这并不意味着所有客户端都必须实现相同的流程。可能有些客户端根本不支持自动完成，所以它们只是允许用户将原始 [NIP-19](19_ZH.md) 代码粘贴到文本正文中，然后在发布事件之前为这些添加 `nostr:` 前缀。
- 引用其他事件的流程类似：用户可以粘贴 `note1...` 或 `nevent1...` 代码，客户端会将其转换为 `nostr:note1...` 或 `nostr:nevent1...` URL。然后在读取此类引用时，客户端可能会在预览框中显示引用的笔记或类似的东西——或者什么都不做。
- 可以采用其他显示程序：例如，如果设计为仅处理 `kind:1` 文本笔记的客户端看到，例如，`.content` 中的 [`kind:30023`](23_ZH.md) `nostr:naddr1...` URL 引用，它可以，例如，决定将其转换为指向某个能够显示此类事件的硬编码 Web 应用程序的链接。
- 客户端可以给用户选择是否为提及的事件或档案包含标签的选项。如果有人想要提及 `mattn` 而不通知他们，但仍然在他们的笔记中有一个很好的可增强/可点击的链接到他们的档案，他们可以指示他们的客户端_不要_为该特定提及创建 `["p", ...]` 标签。
- 同样，如果有人想要引用另一个笔记，但他们的引用不是为了与对同一笔记的其他回复一起显示，他们的客户端可以选择不为 `.content` 内的任何给定 `nostr:nevent1...` URL 包含相应的 `["e", ...]` 标签。客户端可能决定向用户公开这些高级功能或对事物更有主见。
