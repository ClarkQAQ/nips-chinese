NIP-28
======

公共聊天
-----------

`草案` `可选`

此 NIP 定义了公共聊天频道、频道消息和基本客户端审核的新事件类型。

它预留了五种事件类型（40-44）供立即使用：

- `40 - 创建频道`
- `41 - 频道元数据`
- `42 - 频道消息`
- `43 - 隐藏消息`
- `44 - 禁言用户`

以客户端为中心的审核让客户端开发者可以自由决定在其应用中包含哪些类型的内容，同时不对中继器施加额外要求。

## 类型 40：创建频道

创建一个公共聊天频道。

在频道创建的 `content` 字段中，客户端应该包含基本频道元数据（如类型 41 中指定的 `name`、`about`、`picture` 和 `relays`）。

```jsonc
{
  "content": "{\"name\": \"演示频道\", \"about\": \"一个测试频道。\", \"picture\": \"https://placekitten.com/200/200\", \"relays\": [\"wss://nos.lol\", \"wss://nostr.mom\"]}",
 // 其他字段...
}
```


## 类型 41：设置频道元数据

更新频道的公共元数据。

类型 41 用于更新元数据而不修改频道的事件 id。每个 `e` 标签值只有最新的类型 41 可能可用。

客户端应该忽略来自非类型 40 公钥的类型 41 事件。

客户端应该支持基本元数据字段：

- `name` - 字符串 - 频道名称
- `about` - 字符串 - 频道描述
- `picture` - 字符串 - 频道图片的 URL
- `relays` - 数组 - 下载和广播事件的中继器列表

客户端可以添加其他元数据字段。

客户端应该使用 [NIP-10](10.md) 标记的 "e" 标签来推荐中继器。

也可以使用 "t" 标签设置分类名称。此分类名称可以被搜索和过滤。

```jsonc
{
  "content": "{\"name\": \"更新的演示频道\", \"about\": \"更新测试频道。\", \"picture\": \"https://placekitten.com/201/201\", \"relays\": [\"wss://nos.lol\", \"wss://nostr.mom\"]}",
  "tags": [
    ["e", <频道创建事件ID>, <中继URL>, "root"],
    ["t", <分类名称-1>],
    ["t", <分类名称-2>],
    ["t", <分类名称-3>],
  ],
  // 其他字段...
}
```


## 类型 42：创建频道消息

向频道发送文本消息。

客户端应该使用 [NIP-10](10.md) 标记的 "e" 标签来推荐中继器并指定它是回复还是根消息。

客户端应该在回复中添加 [NIP-10](10.md) "p" 标签。

根消息：

```jsonc
{
  "content": <字符串>,
  "tags": [["e", <类型40事件ID>, <中继URL>, "root"]],
  // 其他字段...
}
```

回复另一条消息：

```jsonc
{
  "content": <字符串>,
  "tags": [
      ["e", <类型40事件ID>, <中继URL>, "root"],
      ["e", <类型42事件ID>, <中继URL>, "reply"],
      ["p", <公钥>, <中继URL>],
      // 其余标签...
  ],
  // 其他字段...
}
```


## 类型 43：隐藏消息

用户不再想看到某条消息。

`content` 可以选择性地包含元数据，如 `reason`。

如果来自该用户的事件 43 与事件 42 的 `id` 匹配，客户端应该对给定用户隐藏显示的事件 42。

客户端可以对发送事件 43 的用户以外的其他用户隐藏事件 42。

（例如，如果三个用户"隐藏"一个事件，给出的理由包含"色情"一词，那么作为 iOS 应用的 Nostr 客户端可能会选择为所有 iOS 客户端隐藏该消息。）

```jsonc
{
  "content": "{\"reason\": \"不当图片\"}",
  "tags": [["e", <类型42事件ID>]],
  // 其他字段...
}
```

## 类型 44：禁言用户

用户不再想看到来自另一个用户的消息。

`content` 可以选择性地包含元数据，如 `reason`。

如果来自该用户的事件 44 与事件 42 的 `pubkey` 匹配，客户端应该对给定用户隐藏显示的事件 42。

客户端可以对发送事件 44 的用户以外的用户隐藏事件 42。

```jsonc
{
  "content": "{\"reason\": \"发布不当图片\"}",
  "tags": [["p", <公钥>]],
  // 其他字段...
}
```

## 中继器推荐

客户端应该使用元数据事件的中继器 URL。

客户端可以使用任何中继器 URL。例如，如果托管频道原始类型 40 事件的中继器离线，客户端可以从备份中继器获取频道数据，或者从客户端比原始中继器更信任的中继器获取。

动机
----------
如果我们要解决社交媒体的抗审查通信问题，我们也不妨为类似 Telegram 的消息传递解决这个问题。

我们可以将全球对话从围墙花园带到对所有人开放的真正公共广场。


附加信息
---------------

- [与 fiatjaf+jb55 评论的聊天演示 PR](https://github.com/ArcadeCity/arcade/pull/28)
- [关于 NIP16 的对话](https://t.me/nostr_protocol/29566)
