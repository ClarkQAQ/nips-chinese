NIP-11
======

中继器信息文档
--------------------------

`草案` `可选`

中继器可以向客户端提供服务器元数据，告知它们功能、管理联系人和各种服务器属性。这通过 HTTP 上的 JSON 文档提供，在与中继器的 WebSocket 相同的 URI 上。

当中继器收到带有 `Accept` 头为 `application/nostr+json` 的 HTTP(s) 请求到支持 WebSocket 升级的 URI 时，它们应该返回具有以下结构的文档。

```json
{
  "name": <标识中继器的字符串>,
  "description": <包含详细信息的字符串>,
  "banner": <图像链接（例如 .jpg 或 .png 格式）>,
  "icon": <图标链接（例如 .jpg 或 .png 格式）>,
  "pubkey": <管理联系人公钥>,
  "contact": <管理替代联系方式>,
  "supported_nips": <中继器支持的 NIP 编号列表>,
  "software": <标识中继器软件 URL 的字符串>,
  "version": <字符串版本标识符>,
  "privacy_policy": <描述中继器隐私政策的文本文件链接>,
  "terms_of_service": <描述中继器服务条款的文本文件链接>,
}
```

任何字段都可以省略，客户端必须忽略它们不理解的任何附加字段。中继器必须通过发送 `Access-Control-Allow-Origin`、`Access-Control-Allow-Headers` 和 `Access-Control-Allow-Methods` 头来接受 CORS 请求。

字段描述
------------------

### 名称

中继器可以选择一个 `name` 在客户端软件中使用。这是一个字符串，应该少于 30 个字符以避免客户端截断。

### 描述

关于中继器的详细纯文本信息可以包含在 `description` 字符串中。建议这不包含标记、格式或换行符用于换行，并简单地使用双换行符来分隔段落。长度没有限制。

### 横幅

为了使 nostr 中继器管理更加用户友好，中继器所有者应该努力与非开发者非技术 nostr 终端用户沟通。横幅是中继器的视觉表示。它应该旨在视觉上传达中继器的品牌，补充文本 `Description`。[这是一个示例横幅](https://image.nostr.build/232ddf6846e8aea5a61abcd70f9222ab521f711aa545b7ab02e430248fa3a249.png)模型，如在 Damus iOS 中继器视图中可视化的 Damus 中继器。

### 图标

图标是中继器的紧凑视觉表示，用于具有有限空间的 UI 中，如 nostr 用户的中继器列表视图。下面是一个指向用作中继器图标的图像的示例 URL。建议是方形的。

```jsonc
{
  "icon": "https://nostr.build/i/53866b44135a27d624e99c6165cabd76ac8f72797209700acb189fce75021f47.jpg",
  // 其他字段...
}
```

### 公钥

管理联系人可以用 `pubkey` 列出，格式与 Nostr 事件相同（`secp256k1` 公钥的 32 字节十六进制）。如果列出了联系人，这为客户端提供了向系统管理员发送加密直接消息（参见 [NIP-17](17_ZH.md)）的推荐地址。此地址的预期用途是报告滥用或非法内容、提交错误报告或请求其他技术援助。

中继器运营商没有义务回应直接消息。

### 联系方式

替代联系方式也可以在 `contact` 字段下列出，目的与 `pubkey` 相同。应该优先使用 Nostr 公钥和直接消息。此字段的内容应该是 URI，使用 `mailto` 或 `https` 等方案为用户提供联系方式。

### 支持的 NIP

随着 Nostr 协议的发展，某些功能可能只能由实现特定 `NIP` 的中继器提供。此字段是在中继器中实现的 `NIP` 的整数标识符数组。例子包括 `1`，表示 `"NIP-01"`，以及 `9`，表示 `"NIP-09"`。客户端 `NIP` 不应该被宣传，可以被客户端忽略。

### 软件

中继器服务器实现可以在 `software` 属性中提供。如果存在，这必须是项目主页的 URL。

### 版本

中继器可以选择将其软件版本作为字符串属性发布。字符串格式由中继器实现定义。建议这是版本号或提交标识符。

### 隐私政策

中继器所有者/管理员可以选择链接到隐私政策文档，该文档描述了中继器如何使用用户数据。应该包括数据收集、数据使用、数据保留、数据货币化和第三方数据共享。

### 服务条款

中继器所有者/管理员可以选择链接到服务条款文档。

额外字段
------------

### 服务器限制

这些是中继器对客户端施加的限制。您的客户端应该预期超过这些*实际*限制的请求会被拒绝或立即失败。

```jsonc
{
  "limitation": {
    "max_message_length": 16384,
    "max_subscriptions": 300,
    "max_limit": 5000,
    "max_subid_length": 100,
    "max_event_tags": 100,
    "max_content_length": 8196,
    "min_pow_difficulty": 30,
    "auth_required": true,
    "payment_required": true,
    "restricted_writes": true,
    "created_at_lower_limit": 31536000,
    "created_at_upper_limit": 3,
    "default_limit": 500
  },
  // 其他字段...
}
```

- `max_message_length`：中继器将尝试解码和处理的传入 JSON 的最大字节数。当您发送大型订阅时，您将受到此值的限制。它也有效地限制了任何事件的最大大小。值从 UTF-8 序列化后的 `[` 到 `]` 计算（因此某些 unicode 字符将花费 2-3 字节）。它等于 WebSocket 消息帧的最大大小。

- `max_subscriptions`：在与此中继器的单个 WebSocket 连接上可能活跃的订阅总数。与中继器有（付费）关系的经过身份验证的客户端可能有更高的限制。

- `max_subid_length`：订阅 ID 作为字符串的最大长度。

- `max_limit`：中继器服务器将把每个过滤器的 `limit` 值限制为此数字。这意味着客户端无法从单个订阅过滤器获得超过此数字的事件。此限制通常由中继器静默完成，但有了这个数字，您可以知道如果您缩小过滤器的时间范围或其他参数，还有其他结果。

- `max_event_tags`：在任何事件中，这是 `tags` 列表中元素的最大数量。

- `max_content_length`：任何事件的 `content` 字段中的最大字符数。这是 unicode 字符的计数。序列化为 JSON 后可能更大（以字节为单位），如果定义了 `max_message_length`，仍然受其约束。

- `min_pow_difficulty`：新事件将需要至少这种难度的 PoW，基于 [NIP-13](13_ZH.md)，否则将被此服务器拒绝。

- `auth_required`：此中继器要求在新连接执行任何其他操作之前进行 [NIP-42](42_ZH.md) 身份验证。即使设置为 False，特定操作也可能需要身份验证。

- `payment_required`：此中继器要求在新连接执行任何操作之前付款。

- `restricted_writes`：此中继器要求满足某种条件才能接受事件（不一定包括但包括 `payment_required` 和 `min_pow_difficulty`）。只有当用户在尝试写入之前应该知道中继器政策时才应设置为 `true` —— 如属于特殊的基于公钥的白名单或仅写入特定小众种类或内容的事件。例如，正常的反垃圾邮件启发式不符合条件。

- `created_at_lower_limit`：'created_at' 下限

- `created_at_upper_limit`：'created_at' 上限

- `default_limit`：如果您发送没有 `limit` 的过滤器，返回的最大事件数。

### 事件保留

永久存储数据可能有相关成本，因此中继器可能希望声明保留时间。这里声明的值是未经身份验证的用户和访客的默认值。付费用户可能会有其他政策。

保留时间以秒为单位给出，`null` 表示无限。如果提供零，这意味着事件根本不会被存储，最好在收到这些事件时提供错误。

```jsonc
{
  "retention": [
    {"kinds": [0, 1, [5, 7], [40, 49]], "time": 3600},
    {"kinds": [[40000, 49999]], "time": 100},
    {"kinds": [[30000, 39999]], "count": 1000},
    {"time": 3600, "count": 10000}
  ],
  // 其他字段...
}
```

`retention` 是规范列表：每个将应用于所有种类或种类的子集。种类字段可以将范围指定为包含开始和结束值的元组。指定种类（或全部）的事件然后限制为 `count` 和/或时间段。

通过为这些 `kind` 值给出零保留时间，可以有效地将依赖于特定 `kind` 编号的基于 Nostr 的协议列入黑名单。虽然这很不幸，但它确实允许客户端通过单个 HTTP 获取快速发现将支持其协议的服务器。

没有必要为_临时事件_指定保留时间，因为它们不会被保留。

### 内容限制

一些中继器可能受到民族国家任意法律的管辖。这可能限制在这些中继器上以明文存储的内容。鼓励所有客户端使用加密来绕过此限制。

无法描述每个国家法律和政策的限制，这些法律和政策本身通常是模糊的并且不断变化。

因此，此字段允许中继器运营商指示哪些国家的法律最终可能对他们执行，然后间接地对他们用户的内容执行。

用户应该能够避免他们不喜欢的国家的中继器，和/或选择更有利区域的中继器。暴露这种灵活性取决于客户端软件。

```jsonc
{
  "relay_countries": [ "CA", "US" ],
  // 其他字段...
}
```

- `relay_countries`：可能影响此中继器的两级 ISO 国家代码（ISO 3166-1 alpha-2）列表。`EU` 可用于欧盟国家。`*` 可用于全球中继器。

记住中继器可能托管在不是拥有中继器的法人实体的国家的国家中，因此很可能涉及多个国家。

### 社区偏好

至少对于公共文本笔记，中继器可能试图培养本地社区。这将鼓励用户除了他们通常的个人关注外，还关注该中继器上的全球信息流。为了支持这个目标，中继器可以指定以下一些值。

```jsonc
{
  "language_tags": ["en", "en-419"],
  "tags": ["sfw-only", "bitcoin-only", "anime"],
  "posting_policy": "https://example.com/posting-policy.html",
  // 其他字段...
}
```

- `language_tags` 是一个有序列表，包含 [IETF 语言标签](https://en.wikipedia.org/wiki/IETF_language_tag)，指示中继器上使用的主要语言。`*` 可用于全球中继器。

- `tags` 是对要讨论的主题的限制列表。例如 `sfw-only` 表示此中继器上仅鼓励"工作安全"内容。这依赖于对"工作""社区"认为"安全"谈论什么的假设。随着时间的推移，可能会出现一组通用标签，允许用户找到适合他们需求的中继器，客户端软件将能够轻松解析这些标签。`bitcoin-only` 标签表示任何*山寨币*、*"加密货币"*或*区块链*评论将被无情地嘲笑。

- `posting_policy` 是指向人类可读页面的链接，该页面指定中继器的社区政策。在 `sfw-only` 为 True 的情况下，链接到详细说明您的发布政策的页面很重要。

`description` 字段应用于简要描述您的社区目标和价值观。`posting_policy` 用于附加细节和法律条款。使用 `tags` 字段来表示内容限制或要讨论的主题，这可以由适当的客户端软件进行机器处理。

### 付费中继器

需要付款的中继器可能希望公开其费用表。

```jsonc
{
  "payments_url": "https://my-relay/payments",
  "fees": {
    "admission": [{ "amount": 1000000, "unit": "msats" }],
    "subscription": [{ "amount": 5000000, "unit": "msats", "period": 2592000 }],
    "publication": [{ "kinds": [4], "amount": 100, "unit": "msats" }],
  },
  // 其他字段...
}
```

### 示例

截至 2025 年 3 月 25 日，以下命令提供了这些结果：

```bash
curl -H "Accept: application/nostr+json" https://jellyfish.land | jq
```

```json
{
  "name": "JellyFish",
  "description": "Stay Immortal!",
  "banner": "https://image.nostr.build/7fdefea2dec1f1ec25b8ce69362566c13b2b7f13f1726c2e4584f05f64f62496.jpg",
  "pubkey": "bf2bee5281149c7c350f5d12ae32f514c7864ff10805182f4178538c2c421007",
  "contact": "hi@dezh.tech",
  "software": "https://github.com/dezh-tech/immortal",
  "supported_nips": [
    1,
    9,
    11,
    13,
    17,
    40,
    42,
    59,
    62,
    70
  ],
  "version": "immortal - 0.0.9",
  "relay_countries": [
    "*"
  ],
  "language_tags": [
    "*"
  ],
  "tags": [],
  "posting_policy": "https://jellyfish.land/tos.txt",
  "payments_url": "https://jellyfish.land/relay",
  "icon": "https://image.nostr.build/2547e9ec4b23589e09bc7071e0806c3d4293f76284c58ff331a64bce978aaee8.jpg",
  "retention": [],
  "fees": {
    "subscription": [
      {
        "amount": 3000,
        "period": 2628003,
        "unit": "sats"
      },
      {
        "amount": 8000,
        "period": 7884009,
        "unit": "sats"
      },
      {
        "amount": 15000,
        "period": 15768018,
        "unit": "sats"
      },
      {
        "amount": 28000,
        "period": 31536036,
        "unit": "sats"
      }
    ]
  },
  "limitation": {
    "auth_required": false,
    "max_message_length": 70000,
    "max_subid_length": 256,
    "max_subscriptions": 350,
    "min_pow_difficulty": 0,
    "payment_required": true,
    "restricted_writes": true,
    "max_event_tags": 2000,
    "max_content_length": 70000,
    "created_at_lower_limit": 0,
    "created_at_upper_limit": 2147483647,
    "default_limit": 500,
    "max_limit": 5000
  }
}
```
