NIP-87
======

电子现金铸币厂可发现性
--------------------------------

`草案` `可选`

此 NIP 描述了 `kind:38173`、`kind:38172` 和 `kind:38000`：一种发现电子现金铸币厂、其功能以及推荐它们的人的方法。

## 理由

Nostr 的可发现性和透明事件交互是其最有趣/新颖的机制之一。
此 NIP 为用户提供了一种简单的方法来发现其他用户推荐的电子现金铸币厂并与之交互。

### 涉及的各方

此工作流程中有三个参与者：

* 电子现金铸币厂运营商，宣布其铸币厂及其功能。
    * 发布 `kind:38173` 或 `kind:38172`，详细说明如何连接到它及其功能。
* 用户 A，推荐电子现金铸币厂
    * 发布 `kind:38000`
* 用户 B，寻求电子现金铸币厂的推荐
    * 查询 `kind:38000`，根据结果查询 `kind:38173`/`kind:38172`

## 事件

### 推荐事件
```json
{
  "kind": 38000,
  "pubkey": <推荐者用户公钥>,
  "tags": [
    ["k", "38173"],
    ["d", "<d标识符>"],
    ["u", <推荐的联邦造币邀请码>],
    ["a", "38173:fedimint-pubkey:<d标识符>", "wss://relay1"]
  ],
  "content": "我用生命信任这个铸币厂"
}
```

推荐事件是一个参数化可替换事件，以便用户可以更改编辑其推荐而不创建新事件。

`kind:38000` 中的 `d` 标签是此事件推荐的 `kind:38173`/`kind:38172` 事件标识符，如果不存在事件，仍可以从铸币厂的公钥/id 计算 `d` 标签。
`k` 标签是对应于用户推荐的事件类型的类型编号，在这种情况下，联邦铸币厂为 `kind:38173`，cashu 铸币厂为 `kind:38172`。

可以添加可选的 `u` 标签来提供连接到铸币厂的推荐方式。
标签的值是电子现金铸币厂的 URL 或邀请码。
多个 `u` 标签可以出现在同一个 `kind:38000` 上。

`a` 标签用于指向电子现金铸币厂的 `kind:38173`/`kind:38172` 事件。
标签的第一个值是 `kind:38173`/`kind:38172` 事件标识符，标签的第二个值是中继器提示。
这用于在有重复声称是同一铸币厂的情况下正确指向铸币厂的 `kind:38173`/`kind:38172` 事件。

内容可用于给出评价。

## 电子现金铸币厂信息

Cashu 铸币厂应该发布 `kind:38172` 事件来宣布其功能以及如何连接到它们。

对于 cashu 铸币厂，`u` 标签应该是 cashu 铸币厂的 URL，并且应该列出 cashu 铸币厂支持的 nuts。

`d` 标签应该是铸币厂的公钥（在查询 `/v1/info` 时找到），这样用户就可以通过公钥查询并找到铸币厂公告。

应该添加 `n` 标签来表示 cashu 铸币厂所在的网络（`mainnet`、`testnet`、`signet` 或 `regtest`）

```json
{
  "kind": 38172,
  "pubkey": "<应用程序公钥>",
  "content": "<可选的类似kind:0样式的元数据>",
  "tags": [
    ["d", <cashu铸币厂公钥>],
    ["u", "https://cashu.example.com"],
    ["nuts", "1,2,3,4,5,6,7"],
    ["n", "mainnet"]
  ]
}
```

联邦铸币厂应该发布 `kind:38173` 事件来宣布其功能以及如何连接到它们。

对于联邦铸币厂，它应该在 `u` 标签中列出所有已知的联邦铸币厂邀请码，并且应该列出它支持的模块。

`d` 标签应该是联邦 id，这样用户就可以通过联邦 id 查询并找到联邦铸币厂公告。

应该添加 `n` 标签来表示联邦铸币厂所在的网络（`mainnet`、`testnet`、`signet` 或 `regtest`）

```json
{
  "kind": 38173,
  "pubkey": "<应用程序公钥>",
  "content": "<可选的类似kind:0样式的元数据>",
  "tags": [
    ["d", <联邦ID>],
    ["u", "fed11abc.."],
    ["u", "fed11xyz.."],
    ["modules", "lightning,wallet,mint"],
    ["n", "signet"]
  ]
}
```

* `content` 是一个可选的类似 `metadata` 的字符串化 JSON 对象，如 NIP-01 中所述。当创建 `kind:38173` 的公钥不是普通用户时，此内容很有用。如果 `content` 为空，应该使用公钥的 `kind:0` 来显示铸币厂信息（例如名称、图片、网站、LUD16 等）

## 示例

### 用户 A 推荐一些铸币厂
用户 A 可能是 cashu 铸币厂的用户。使用客户端，用户 A 发布推荐他们使用的 cashu 铸币厂的事件。

```json
{
  "kind": 38000,
  "tags": [
    ["u", "fed11abc..", "fedimint"],
    ["u", "https://cashu.example.com", "cashu"],
    ["a", "38173:fedimint-pubkey:<d标识符>", "wss://relay1", "fedimint"],
    ["a", "38172:cashu-mint-pubkey:<d标识符>", "wss://relay2", "cashu"]
  ],
  ...
}
```

### 用户 B 找到铸币厂
用户 B 想要使用电子现金钱包，他们需要找到一个铸币厂。

用户 B 的钱包客户端查询 `kind:38000` 事件，寻找电子现金铸币厂的推荐。

```json
["REQ", <id>, [{ "kinds": [38000], "authors": [<用户>, <用户联系人列表>], "#k": ["38173"] }]]
```

关注用户 A 的用户 B 看到了 `kind:38000` 事件并尝试连接到相应的铸币厂。

### 绕过 `kind:38000` 的替代查询
或者，用户可能选择直接查询事件类型的 `kind:38173`。客户端在执行此操作时应该小心，并使用垃圾邮件防护机制或查询高质量的受限中继器，以避免将用户引导到恶意处理程序。

```json
["REQ", <id>, [{ "kinds": [38173], "authors": [...] }]]
```
