NIP-72
======

审核社区（Reddit 风格）
------------------------------------

`草案` `可选`

本 NIP 的目标是启用公共社区。它定义了可替换事件 `kind:34550` 来定义社区和当前的版主/管理员列表。想要发布到社区的用户，只需用社区的 `a` 标签标记任何 Nostr 事件。版主可以发出批准事件 `kind:4550`。

## 社区定义

`Kind:34550` 应该包含任何有助于定义社区和版主集合的字段。`relay` 标签可以用来描述下载请求和批准的首选中继器。社区定义事件的 `d` 标签可以兼作其名称，但如果提供了 `name` 标签，应该显示它而不是 `d` 标签。

```jsonc
{
  "created_at": <以秒为单位的 Unix 时间戳>,
  "kind": 34550,
  "tags": [
    ["d", "<社区 d 标识符>"],
    ["name", "<社区名称>"],
    ["description", "<社区描述>"],
    ["image", "<社区图像 URL>", "<宽度>x<高度>"],

    //.. 其他与定义社区相关的标签

    // 版主
    ["p", "<公钥1的 32 字节十六进制>", "<可选推荐中继器 URL>", "moderator"],
    ["p", "<公钥2的 32 字节十六进制>", "<可选推荐中继器 URL>", "moderator"],
    ["p", "<公钥3的 32 字节十六进制>", "<可选推荐中继器 URL>", "moderator"],

    // 社区使用的中继器（带可选标记）
    ["relay", "<托管作者 kind 0 的中继器>", "author"],
    ["relay", "<发送和接收请求的中继器>", "requests"],
    ["relay", "<发送和接收批准的中继器>", "approvals"],
    ["relay", "<发布请求和获取批准的中继器>"]
  ],
  // 其他字段...
}
```

## 发布到社区

[NIP-22](NIP-22.md) kind 1111 事件应该用于发布到社区的文本笔记，`A` 标签始终限定到社区定义。

### 顶级帖子

对于顶级帖子，大写和小写的 NIP-22 标签都应该引用社区定义本身。

```jsonc
{
  "kind": 1111,
  "tags": [
    ["A", "34550:<社区作者公钥>:<社区 d 标识符>", "<可选中继器 URL>"],
    ["a", "34550:<社区作者公钥>:<社区 d 标识符>", "<可选中继器 URL>"],
    ["P", "<社区作者公钥>", "<可选中继器 URL>"],
    ["p", "<社区作者公钥>", "<可选中继器 URL>"],
    ["K", "34550"],
    ["k", "34550"],
  ],
  "content": "大家好。很高兴来到这里！",
  // 其他字段...
}
```

### 嵌套回复

对于嵌套回复，大写标签应该仍然引用社区定义，而小写标签应该引用父帖子或回复。

```jsonc
{
  "kind": 1111,
  "tags": [
    // 社区定义本身
    ["A", "34550:<社区作者公钥>:<社区 d 标识符>", "<可选中继器 URL>"],
    ["P", "<社区作者公钥>", "<可选中继器 URL>"],
    ["K", "34550"],

    // 父帖子或回复
    ["e", "<父事件 ID>", "<可选中继器 URL>"],
    ["p", "<父事件作者公钥>", "<可选中继器 URL>"],
    ["k", "<父事件种类>"] // 很可能是 "1111"
  ],
  "content": "同意！欢迎大家！",
  // 其他字段...
}
```

### 向后兼容性说明

以前 kind 1 事件用于社区中的帖子，带有指向社区的"a"标签。为了向后兼容，客户端可能仍然查询 kind 1 事件，但不应该将它们用于新帖子。相反，客户端应该使用带有如上所述的 `A` 和 `a` 标签的 kind 1111 事件。

## 审核

任何人都可以发出批准事件来表达他们认为帖子适合社区的意见。客户端可以选择尊重哪些批准事件，但至少应该使用群组定义的版主发布的事件。

批准事件必须包含一个或多个社区 `a` 标签，指向帖子的 `e` 或 `a` 标签，以及帖子作者的 `p` 标签（用于批准通知）。`a` 标签前缀可以用来消除社区和可替换事件指针之间的歧义（社区 `a` 标签总是以 `34550` 开头）。

事件还应该在 `.content` 内包含 JSON 字符串化的 `post request` 事件，以及带有原始帖子事件种类的 `k` 标签，以允许按种类过滤批准的帖子。

版主可以随时使用 [NIP-09 事件删除请求](09.md) 请求删除他们对帖子的批准。

```jsonc
{
  "pubkey": "<事件创建者的 32 字节小写十六进制编码公钥>",
  "kind": 4550,
  "tags": [
    ["a", "34550:<事件作者公钥>:<社区 d 标识符>", "<可选中继器 URL>"],
    ["e", "<帖子 ID>", "<可选中继器 URL>"],
    ["p", "<帖子作者公钥>", "<可选中继器 URL>"],
    ["k", "<帖子请求种类>"]
  ],
  "content": "<完整批准事件，JSON 编码>",
  // 其他字段...
}
```

建议多个版主批准帖子，以避免在版主从所有者列表中移除时从社区中删除它们。如果必须轮换完整的版主列表，新的版主集合必须为过去的帖子签署新的批准，否则社区将重新开始。所有者也可以定期复制并重新签署每个版主的批准事件，以确保帖子不会随着版主消失。

可替换事件的批准可以通过三种方式创建：

1. 如果版主想要批准可替换事件的每个单独更改，通过将可替换事件标记为 `e` 标签
2. 如果版主授权可替换事件作者在没有额外批准的情况下进行更改，通过将可替换事件标记为 `a` 标签
3. 通过用其 `e` 和 `a` 标签标记可替换事件，这使客户端能够显示事件的原始和更新版本，在 UI 中带有适当的备注。

由于中继器被指示删除可替换事件的旧版本，使用 `e` 标签的批准的 `content` 必须具有事件的特定版本，否则客户端可能无法在任何地方找到该版本的内容。

客户端应该评估任何非 `34550:*` `a` 标签作为要为所有 `34550:*` `a` 标签批准的帖子。

## 交叉发布

客户端可以通过使用如上所述的 `a` 标签向一个或多个社区发布 NIP 18 `kind 6` 或 `kind 16` 转发来支持社区之间的交叉发布。转发的 `content` 必须是原始事件，而不是批准事件。
