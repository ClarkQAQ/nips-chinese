NIP-69
======

点对点订单事件
-------------------------

`草案` `可选`

## 摘要

点对点 (P2P) 平台近年来出现增长，虽然拥有更多选择是积极的，但在 p2p 的特定情况下，拥有多个选择会导致流动性分割，意味着有时没有足够的资产可供交易。如果我们将所有这些单独的解决方案合并到一个大的订单池中，它将使它们相比于由单一权威控制流动性的中心化系统更具竞争力。

本 NIP 为点对点订单事件定义了一个简单标准，这使得能够为所有参与的 p2p 平台创建一个大的流动性池。

## 事件

事件是[可寻址事件](01_ZH.md#kinds)并使用 `38383` 作为事件种类，p2p 事件如下所示：

```json
{
  "id": "84fad0d29cb3529d789faeff2033e88fe157a48e071c6a5d1619928289420e31",
  "pubkey": "dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a",
  "created_at": 1702548701,
  "kind": 38383,
  "tags": [
    ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
    ["k", "sell"],
    ["f", "VES"],
    ["s", "pending"],
    ["amt", "0"],
    ["fa", "100"],
    ["pm", "face to face", "bank transfer"],
    ["premium", "1"],
    [
      "rating",
      "{\"total_reviews\":1,\"total_rating\":3.0,\"last_rating\":3,\"max_rate\":5,\"min_rate\":1}"
    ],
    ["source", "https://t.me/p2plightning/xxxxxxx"],
    ["network", "mainnet"],
    ["layer", "lightning"],
    ["name", "Nakamoto"],
    ["g", "<地理哈希>"],
    ["bond", "0"],
    ["expiration", "1719391096"],
    ["y", "lnp2pbot"],
    ["z", "order"]
  ],
  "content": "",
  "sig": "7e8fe1eb644f33ff51d8805c02a0e1a6d034e6234eac50ef7a7e0dac68a0414f7910366204fa8217086f90eddaa37ded71e61f736d1838e37c0b73f6a16c4af2"
}
```

## 标签

- `d` < 订单 ID >：订单的唯一标识符。
- `k` < 订单类型 >：`sell` 或 `buy`。
- `f` < 货币 >：正在交易的资产，使用 [ISO 4217](https://en.wikipedia.org/wiki/ISO_4217) 标准。
- `s` < 状态 >：`pending`、`canceled`、`in-progress`、`success`。
- `amt` < 金额 >：要交易的比特币数量，金额以聪为单位定义，如果为 `0` 意味着聪的数量将在接受者接受订单后从公共 API 获得。
- `fa` < 法币金额 >：正在交易的法币金额，对于范围订单，期望两个值，最小和最大金额。
- `pm` < 付款方式 >：用于交易的付款方式，如果订单有多种付款方式，应用逗号分隔。
- `premium` < 溢价 >：制造商愿意支付的溢价百分比。
- `source` [来源]：订单的来源，可以是重定向到订单的 URL。
- `rating` [评级]：制造商的评级，本文档未定义评级如何计算，由平台定义。
- `network` < 网络 >：用于交易的网络，可以是 `mainnet`、`testnet`、`signet` 等。
- `layer` < 层 >：用于交易的层，可以是 `onchain`、`lightning`、`liquid` 等。
- `name` [名称]：制造商的名称。
- `g` [地理哈希]：操作的地理哈希，在面对面交易中可能有用。
- `bond` [保证金]：保证金金额，保证金是双方必须支付的保证金。
- `expiration` < 到期时间 >：订单的到期日期（[NIP-40](40_ZH.md)）。
- `y` < 平台 >：创建订单的平台。
- `z` < 文档 >：`order`。

强制标签用 `<标签>` 括起来，可选标签用 `[标签]` 括起来。

## 实现

目前在以下平台上实现：

- [Mostro](https://github.com/MostroP2P/mostro)
- [@lnp2pBot](https://github.com/lnp2pBot/bot)
- [Robosats](https://github.com/RoboSats/robosats/pull/1362)
- [Peach Bitcoin](https://github.com/Peach2Peach/peach-nostr-announcer-bot)

## 参考

- [Mostro 协议规范](https://mostro.network/protocol/)
- [点对点 NIP 提案的消息规范](https://github.com/nostr-protocol/nips/blob/8250274a22f4882f621510df0054fd6167c10c9e/31001.md)
- [n3xB](https://github.com/nobu-maeda/n3xb)
