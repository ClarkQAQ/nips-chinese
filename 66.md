NIP-66
======

中继器发现和活跃性监控
-------------------

`草案` `可选`

本 NIP 定义了中继器发现和中继器监控器公告的事件。

## 中继器发现事件

`30166` 中继器发现事件记录从中继器的 [NIP 11](https://github.com/nostr-protocol/nips/blob/master/11.md) 文档推断或通过探测获得的中继器特征。

对应于中继器 NIP 11 文档中字段的信息，如果监控器发现实施的策略与宣传的不同，可能与实际值矛盾。

`content` 可能包含中继器的 NIP-11 信息文档的字符串化 JSON。

唯一必需的标签是 `d` 标签，必须设置为中继器的[标准化](https://datatracker.ietf.org/doc/html/rfc3986#section-6) URL。对于无法通过 URL 访问的中继器，可以使用十六进制编码的公钥。

其他标签包括：

- `rtt-open` - 中继器的开放往返时间（毫秒）。
- `rtt-read` - 中继器的读取往返时间（毫秒）。
- `rtt-write` - 中继器的写入往返时间（毫秒）。
- `n` - 中继器的网络类型。应该是 `clearnet`、`tor`、`i2p`、`loki` 之一
- `T` - 中继器类型。枚举的[中继器类型](https://github.com/nostr-protocol/nips/issues/1282)，格式为 `PascalCase`，例如 `PrivateInbox`
- `N` - 中继器支持的 NIP
- `R` - 根据 [NIP 11](https://github.com/nostr-protocol/nips/blob/master/11.md) 的 `limitations` 数组对应于要求的键，包括 `auth`、`writes`、`pow` 和 `payment`。假值应使用 `!` 前缀指定，例如 `!auth`。
- `t` - 与此中继器关联的主题
- `k` - 中继器接受的事件种类
- `!k` - 中继器不接受的事件种类
- `g` - [NIP-52](https://github.com/nostr-protocol/nips/blob/master/52.md) 地理哈希
- `l` - 语言标签

具有多个值的标签应重复，而不是将所有值放在单个标签中，例如 `[["t", "cats"], ["t", "dogs"]]`，而不是 `[["t", "cats", "dogs"]]`。

示例：

```json
{
  "id": "<eventid>",
  "pubkey": "<监控器的公钥>",
  "created_at": "<created_at [某个最近日期...]>",
  "signature": "<签名>",
  "content": "<可选的 nip 11 文档>",
  "kind": 30166,
  "tags": [
    ["d","wss://some.relay/"],
    ["n", "clearnet"],
    ["N", "40"],
    ["N", "33"],
    ["R", "!payment"],
    ["R", "auth"],
    ["g", "ww8p1r4t8"],
    ["l", "en", "ISO-639-1"],
    ["t", "nsfw" ],
    ["rtt-open", 234 ]
  ]
}
```

## 中继器监控器公告

种类 `10166` 中继器监控器公告宣传作者发布 `30166` 事件的意图。此事件是可选的，适用于打算以定期和可预测频率提供监控服务的监控器。

标签包括：

- `frequency` - 监控器发布事件的频率（秒）。
- `timeout`（可选）- 监控器进行的各种检查的超时值。索引 `1` 是监控器的超时时间（毫秒）。索引 `2` 描述超时用于哪个测试。如果没有提供索引 `2`，则推断提供的超时适用于所有测试。
- `c` - 描述监控器进行的检查的小写字符串。示例包括 `open`、`read`、`write`、`auth`、`nip11`、`dns` 和 `geo`。
- `g` - [NIP-52](https://github.com/nostr-protocol/nips/blob/master/11.md) 地理哈希标签

监控器也应该发布 `kind 0` 档案和 `kind 10002` 中继器选择事件。

示例：

```json
{
  "id": "<eventid>",
  "pubkey": "<监控器的公钥>",
  "created_at": "<created_at [某个最近日期...]>",
  "signature": "<签名>",
  "content": "",
  "tags": [
    [ "timeout", "open", "5000"  ],
    [ "timeout", "read", "3000"  ],
    [ "timeout", "write", "3000" ],
    [ "timeout", "nip11", "3000" ],
    [ "frequency", "3600" ],
    [ "c", "ws" ],
    [ "c", "nip11" ],
    [ "c", "ssl" ],
    [ "c", "dns" ],
    [ "c", "geo" ]
    [ "g", "ww8p1r4t8" ]
  ]
}
```
