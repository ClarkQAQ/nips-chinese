NIP-98
======

HTTP 认证
---------

`草案` `可选`

此 NIP 定义了一个临时事件，用于使用 nostr 事件授权对 HTTP 服务器的请求。

这对于为 Nostr 构建并处理 Nostr 用户账户的 HTTP 服务很有用。

## Nostr 事件

使用 `kind 27235`（参考 [RFC 7235](https://www.rfc-editor.org/rfc/rfc7235)）事件。

`content` 应该为空。

必须包含以下标签。

* `u` - 绝对 URL
* `method` - HTTP 请求方法

示例事件：
```json
{
  "id": "fe964e758903360f28d8424d092da8494ed207cba823110be3a57dfe4b578734",
  "pubkey": "63fe6318dc58583cfe16810f86dd09e18bfd76aabc24a0081ce2856f330504ed",
  "content": "",
  "kind": 27235,
  "created_at": 1682327852,
  "tags": [
    ["u", "https://api.snort.social/api/v1/n5sp/list"],
    ["method", "GET"]
  ],
  "sig": "5ed9d8ec958bc854f997bdc24ac337d005af372324747efe4a00e24f4c30437ff4dd8308684bed467d9d6be3e5a517bb43b1732cc7d33949a3aaf86705c22184"
}
```

服务器必须按顺序执行以下检查以验证事件：
1. `kind` 必须是 `27235`。
2. `created_at` 时间戳必须在合理的时间窗口内（建议 60 秒）。
3. `u` 标签必须与绝对请求 URL（包括查询参数）完全相同。
4. `method` 标签必须与用于请求资源的 HTTP 方法相同。

当请求包含正文时（如在 POST/PUT/PATCH 方法中），客户端应该在 `payload` 标签中包含请求正文的 SHA256 哈希作为十六进制（`["payload", "<sha256-hex>"]`），服务器可以检查这一点以验证请求的载荷是否被授权。

如果其中一项检查失败，服务器应该返回 401 未授权响应代码。

服务器可以执行额外的特定于实现的验证检查。

## 请求流程

使用 `Authorization` HTTP 标头，`kind 27235` 事件必须是 `base64` 编码并使用授权方案 `Nostr`

示例 HTTP 授权标头：
```
Authorization: Nostr 
eyJpZCI6ImZlOTY0ZTc1ODkwMzM2MGYyOGQ4NDI0ZDA5MmRhODQ5NGVkMjA3Y2JhODIzMTEwYmUzYTU3ZGZlNGI1Nzg3MzQiLCJwdWJrZXkiOiI2M2ZlNjMxOGRjNTg1ODNjZmUxNjgxMGY4NmRkMDllMThiZmQ3NmFhYmMyNGEwMDgxY2UyODU2ZjMzMDUwNGVkIiwiY29udGVudCI6IiIsImtpbmQiOjI3MjM1LCJjcmVhdGVkX2F0IjoxNjgyMzI3ODUyLCJ0YWdzIjpbWyJ1IiwiaHR0cHM6Ly9hcGkuc25vcnQuc29jaWFsL2FwaS92MS9uNXNwL2xpc3QiXSxbIm1ldGhvZCIsIkdFVCJdXSwic2lnIjoiNWVkOWQ4ZWM5NThiYzg1NGY5OTdiZGMyNGFjMzM3ZDAwNWFmMzcyMzI0NzQ3ZWZlNGEwMGUyNGY0YzMwNDM3ZmY0ZGQ4MzA4Njg0YmVkNDY3ZDlkNmJlM2U1YTUxN2JiNDNiMTczMmNjN2QzMzk0OWEzYWFmODY3MDVjMjIxODQifQ
```

## 参考实现
- C# ASP.NET `AuthenticationHandler` [NostrAuth.cs](https://gist.github.com/v0l/74346ae530896115bfe2504c8cd018d3)
