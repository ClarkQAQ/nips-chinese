NIP-50
======

搜索功能
-----------------

`草案` `可选`

## 摘要

许多 Nostr 用例需要某种形式的通用搜索功能，除了按标签或 ID 进行结构化查询之外。搜索算法的具体细节在不同事件种类之间会有所不同，本 NIP 仅描述了执行此类查询的通用可扩展框架。

## `search` 过滤器字段

为来自客户端的 `REQ` 消息引入了新的 `search` 字段：
```jsonc
{
  // 过滤器对象上的其他字段...
  "search": <字符串>
}
```
`search` 字段是一个以人类可读形式描述查询的字符串，即"最佳 nostr 应用"。中继器应该尽其所能解释查询并返回匹配的事件。中继器应该对 `content` 事件字段执行匹配，如果在特定种类的上下文中有意义，也可以对其他字段执行匹配。

结果应该按搜索结果质量（由实现定义）的降序返回，而不是按通常的 `.created_at`。`limit` 过滤器应该在按匹配分数排序后应用。查询字符串可能包含 `key:value` 对（由冒号分隔的两个单词），这些是扩展，中继器应该忽略它们不支持的扩展。

客户端可以指定多个搜索过滤器，即 `["REQ", "", { "search": "orange" }, { "kinds": [1, 2], "search": "purple" }]`。客户端可以包含 `kinds`、`ids` 和其他过滤器字段来将搜索结果限制为特定事件种类。

客户端应该使用 supported_nips 字段来了解中继器是否支持 `search` 过滤器。如果客户端准备好过滤掉不支持此 NIP 的中继器的无关响应，它们可以向任何中继器发送 `search` 过滤器查询。

客户端应该查询多个支持此 NIP 的中继器，以补偿中继器之间潜在的不同实现细节。

客户端可以验证中继器返回的事件是否以适合客户端用例的方式匹配指定查询，并且可以停止查询精度低的中继器。

如果中继器支持某种形式的垃圾邮件过滤，它们应该默认从搜索结果中排除垃圾邮件。

## 扩展

中继器可以支持这些扩展：
- `include:spam` - 关闭垃圾邮件过滤（如果默认启用）
- `domain:<域名>` - 仅包含来自有效 nip05 域名匹配该域名的用户的事件
- `language:<两个字母的 ISO 639-1 语言代码>` - 仅包含指定语言的事件
- `sentiment:<negative/neutral/positive>` - 仅包含特定情感的事件
- `nsfw:<true/false>` - 包含或排除 nsfw 事件（默认：true）
