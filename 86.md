NIP-86
======

中继器管理 API
--------------------

`草案` `可选`

中继器可以提供用于执行管理任务的 API。这作为类似 JSON-RPC 的请求-响应协议通过 HTTP 在与中继器 websocket 相同的 URI 上提供。

当中继器接收到具有 `Content-Type` 标头为 `application/nostr+json+rpc` 的 HTTP(s) 请求到支持 WebSocket 升级的 URI 时，它应该将请求解析为具有以下字段的 JSON 文档：

```json
{
  "method": "<方法名称>",
  "params": ["<参数>", "<数组>", "<格式>"]
}
```

然后它应该返回格式为以下的响应

```json
{
  "result": {"<任意>": "<值>"},
  "error": "<可选错误消息，如果调用出错>"
}
```

这是可能支持的**方法**列表：

* `supportedmethods`:
  - params: `[]`
  - result: `["<方法名称>", "<方法名称>", ...]`（包含所有其他支持方法名称的数组）
* `banpubkey`:
  - params: `["<32字节十六进制公钥>", "<可选原因>"]`
  - result: `true`（始终设置为 `true` 的布尔值）
* `listbannedpubkeys`:
  - params: `[]`
  - result: `[{"pubkey": "<32字节十六进制>", "reason": "<可选原因>"}, ...]`，对象数组
* `allowpubkey`:
  - params: `["<32字节十六进制公钥>", "<可选原因>"]`
  - result: `true`（始终设置为 `true` 的布尔值）
* `listallowedpubkeys`:
  - params: `[]`
  - result: `[{"pubkey": "<32字节十六进制>", "reason": "<可选原因>"}, ...]`，对象数组
* `listeventsneedingmoderation`:
  - params: `[]`
  - result: `[{"id": "<32字节十六进制>", "reason": "<可选原因>"}]`，对象数组
* `allowevent`:
  - params: `["<32字节十六进制事件ID>", "<可选原因>"]`
  - result: `true`（始终设置为 `true` 的布尔值）
* `banevent`:
  - params: `["<32字节十六进制事件ID>", "<可选原因>"]`
  - result: `true`（始终设置为 `true` 的布尔值）
* `listbannedevents`:
  - params: `[]`
  - result: `[{"id": "<32字节十六进制>", "reason": "<可选原因>"}, ...]`，对象数组
* `changerelayname`:
  - params: `["<新名称>"]`
  - result: `true`（始终设置为 `true` 的布尔值）
* `changerelaydescription`:
  - params: `["<新描述>"]`
  - result: `true`（始终设置为 `true` 的布尔值）
* `changerelayicon`:
  - params: `["<新图标URL>"]`
  - result: `true`（始终设置为 `true` 的布尔值）
* `allowkind`:
  - params: `[<类型数字>]`
  - result: `true`（始终设置为 `true` 的布尔值）
* `disallowkind`:
  - params: `[<类型数字>]`
  - result: `true`（始终设置为 `true` 的布尔值）
* `listallowedkinds`:
  - params: `[]`
  - result: `[<类型数字>, ...]`，数字数组
* `blockip`:
  - params: `["<IP地址>", "<可选原因>"]`
  - result: `true`（始终设置为 `true` 的布尔值）
* `unblockip`:
  - params: `["<IP地址>"]`
  - result: `true`（始终设置为 `true` 的布尔值）
* `listblockedips`:
  - params: `[]`
  - result: `[{"ip": "<IP地址>", "reason": "<可选原因>"}, ...]`，对象数组

### 授权

请求必须包含带有有效 [NIP-98](./98.md) 事件的 `Authorization` 标头，除了需要 `payload` 标签。`u` 标签是中继器 URL。

如果未提供 `Authorization` 或无效，端点应该返回 401 响应。
