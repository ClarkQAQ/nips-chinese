NIP-52
======

日历事件
---------------

`草案` `可选`

本规范定义了表示在特定时刻或时刻之间发生的日历事件。这些日历事件是_可寻址的_，并且可以根据 [NIP-09](09.md) 删除。

与此 NIP 特有的术语 `日历事件` 不同，术语 `事件` 在所有 NIP 中广泛用于描述任何 Nostr 事件。这里进行区分是为了辨别两个术语。

## 日历事件

有两种类型的日历事件，由不同的种类表示：_基于日期的_和_基于时间的_日历事件。

这些标签对两种类型的日历事件都是通用的：

* `d`（必需）短的唯一字符串标识符。由创建日历事件的客户端生成。
* `title`（必需）日历事件的标题
* `summary`（可选）日历事件的简要描述
* `image`（可选）用于事件的图像 URL
* `location`（可选，重复）日历事件的位置。例如地址、GPS 坐标、会议室名称、视频通话链接
* `g`（可选）[地理哈希](https://en.wikipedia.org/wiki/Geohash)，将日历事件与可搜索的物理位置关联
* `p`（可选，重复）参与者的 32 字节十六进制公钥、可选推荐中继器 URL，以及参与者在会议中的角色
* `t`（可选，重复）用于分类日历事件的标签
* `r`（可选，重复）对网页、文档、视频通话、录制视频等的引用/链接
* `a`（重复）对 kind `31924` 日历事件的引用标签，请求包含在日历中

以下标签已弃用：

* `name` 日历事件的名称。仅在 `title` 不可用时使用。

日历事件_不_需要成为[日历](#日历)的一部分。

## 协作日历事件请求

日历事件可以包含引用日历（kind 31924）的 `a` 标签，以请求添加到该日历。当日历事件包含此类引用时，客户端应该将其解释为通过用 `a` 标签引用该事件来将事件添加到引用日历的请求。

这使得协作日历管理成为可能，多个用户可以向他们不拥有的日历贡献事件，但需要日历所有者的批准。

### 基于日期的日历事件

这种日历事件在某个日期开始，在未来的不同日期之前结束。它适用于时间和时区不重要的全天或多天事件。例如，纪念日、公共假期、假期天数。

它是 `kind:31922` 的_可寻址事件_。

这些事件的 `.content` 应该是日历事件的描述。

除了通用标签外，这还采用以下标签：

* `start`（必需）ISO 8601 格式（YYYY-MM-DD）的包含开始日期。如果存在 `end`，必须小于 `end`。
* `end`（可选）ISO 8601 格式（YYYY-MM-DD）的排他结束日期。如果省略，日历事件在与 `start` 相同的日期结束。

示例：

```yaml
{
  "id": <序列化事件数据的 32 字节小写十六进制编码 SHA-256>,
  "pubkey": <事件创建者的 32 字节小写十六进制编码公钥>,
  "created_at": <以秒为单位的 unix 时间戳>,
  "kind": 31922,
  "content": "<日历事件描述>",
  "tags": [
    ["d", "<随机标识符>"],

    ["title", "<日历事件标题>"],

    // 日期
    ["start", "<YYYY-MM-DD>"],
    ["end", "<YYYY-MM-DD>"],

    // 位置
    ["location", "<位置>"],
    ["g", "<地理哈希>"],

    // 参与者
    ["p", "<公钥的 32 字节十六进制>", "<可选推荐中继器 URL>", "<角色>"],
    ["p", "<公钥的 32 字节十六进制>", "<可选推荐中继器 URL>", "<角色>"],
  ]
}
```

### 基于时间的日历事件

这种日历事件跨越开始时间和结束时间之间。

它是 `kind:31923` 的_可寻址事件_。

这些事件的 `.content` 应该是日历事件的描述。它是必需的，但可以是空字符串。

除了通用标签外，这还采用以下标签：

* `start`（必需）包含的开始 Unix 时间戳（以秒为单位）。如果存在 `end`，必须小于 `end`。
* `end`（可选）排他的结束 Unix 时间戳（以秒为单位）。如果省略，日历事件立即结束。
* `start_tzid`（可选）开始时间戳的时区，由 IANA 时区数据库定义。例如，`America/Costa_Rica`
* `end_tzid`（可选）结束时间戳的时区，由 IANA 时区数据库定义。例如，`America/Costa_Rica`。如果省略且提供了 `start_tzid`，结束时间戳的时区与开始时间戳相同。

```yaml
{
  "id": <序列化事件数据的 32 字节小写十六进制编码 SHA-256>,
  "pubkey": <事件创建者的 32 字节小写十六进制编码公钥>,
  "created_at": <以秒为单位的 unix 时间戳>,
  "kind": 31923,
  "content": "<日历事件描述>",
  "tags": [
    ["d", "<随机标识符>"],

    ["title", "<日历事件标题>"],
    ["summary", "<日历事件的简要描述>"],
    ["image", "<图像 URI 字符串>"],

    // 时间戳
    ["start", "<以秒为单位的 unix 时间戳>"],
    ["end", "<以秒为单位的 unix 时间戳>"],

    ["start_tzid", "<IANA 时区数据库标识符>"],
    ["end_tzid", "<IANA 时区数据库标识符>"],

    // 位置
    ["location", "<位置>"],
    ["g", "<地理哈希>"],

    // 参与者
    ["p", "<公钥的 32 字节十六进制>", "<可选推荐中继器 URL>", "<角色>"],
    ["p", "<公钥的 32 字节十六进制>", "<可选推荐中继器 URL>", "<角色>"],
  ]
}
```

## 日历

日历是日历事件的集合，表示为使用 kind `31924` 的自定义_可寻址列表_事件。用户可以有多个日历。可以创建日历来为特定目的分割日历事件。例如，个人、工作、旅行、聚会和会议。

日历可以接受来自其他用户的事件请求。当日历事件通过 `a` 标签引用日历时，这表示包含请求。

这些事件的 `.content` 应该是日历的详细描述。它是必需的，但可以是空字符串。

* `d`（必需）全球唯一标识符。由创建日历的客户端生成。
* `title`（必需）日历标题
* `a`（重复）对正在响应的 kind `31922` 或 `31923` 日历事件的引用标签

```yaml
{
  "id": <序列化事件数据的 32 字节小写十六进制编码 SHA-256>,
  "pubkey": <事件创建者的 32 字节小写十六进制编码公钥>,
  "created_at": <以秒为单位的 unix 时间戳>,
  "kind": 31924,
  "content": "<日历描述>",
  "tags": [
    ["d", "<随机标识符>"],
    ["title", "<日历标题>"],
    ["a", "<31922 或 31923>:<日历事件作者公钥>:<日历事件的 d 标识符>", "<可选中继器 URL>"],
    ["a", "<31922 或 31923>:<日历事件作者公钥>:<日历事件的 d 标识符>", "<可选中继器 URL>"]
  ]
}
```

## 日历事件 RSVP

日历事件 RSVP 是对日历事件的响应，表示用户的出席意图。

如果日历事件标记了公钥，这可以解释为日历事件创建者邀请该用户参加。客户端可以选择提示用户对日历事件进行 RSVP。

任何用户都可以 RSVP，即使他们没有在日历事件上被标记。客户端可以选择提示日历事件创建者邀请进行 RSVP 的用户。客户端也可以选择忽略这些 RSVP。

本 NIP 故意不定义如果进行 RSVP 的用户没有被标记，谁有权参加日历事件。由日历事件创建者确定语义。

本 NIP 也故意不定义如果日历事件在提交 RSVP 后发生变化会发生什么。

RSVP 必须有一个指向日历事件的事件坐标的 `a` 标签，并且可选地有一个特定日历事件修订的 id 的 `e` 标签。如果存在 `e` 标签，客户端应该将其解释为表明 RSVP 是对该日历事件修订的响应，并且可以将其解释为不一定适用于日历事件的其他修订。

RSVP 可以使用 `p` 标签标记它所响应的日历事件的作者，以便客户端可以轻松查询与作者相关的所有 RSVP。

RSVP 是 `kind:31925` 的_可寻址事件_。

这些事件的 `.content` 是可选的，应该是为此日历事件响应添加更多上下文的自由形式笔记。

标签列表如下：

* `a`（必需）对正在响应的 kind `31922` 或 `31923` 日历事件的坐标。
* `e`（可选）对正在响应的 kind `31922` 或 `31923` 日历事件的事件 id。
* `d`（必需）全球唯一标识符。由创建日历事件 RSVP 的客户端生成。
* `status`（必需）`accepted`、`declined` 或 `tentative`。确定对引用日历事件的出席状态。
* `fb`（可选）`free` 或 `busy`。确定用户在日历事件期间是否空闲或忙碌。如果 `status` 标签设置为 `declined`，则必须省略或忽略此标签。
* `p`（可选）正在响应的日历事件作者的公钥。

```yaml
{
  "id": <序列化事件数据的 32 字节小写十六进制编码 SHA-256>,
  "pubkey": <事件创建者的 32 字节小写十六进制编码公钥>,
  "created_at": <以秒为单位的 unix 时间戳>,
  "kind": 31925,
  "content": "<笔记>",
  "tags": [
    ["e", "<kind 31922 或 31923 事件 id", "<可选推荐中继器 URL>"]
    ["a", "<31922 或 31923>:<日历事件作者公钥>:<日历事件的 d 标识符>", "<可选推荐中继器 URL>"],
    ["d", "<随机标识符>"],
    ["status", "<accepted/declined/tentative>"],
    ["fb", "<free/busy>"],
    ["p", "<kind 31922 或 31923 事件的十六进制公钥>", "<可选推荐中继器 URL>"]
  ]
}
```

## 未解决的限制

* 没有私人事件

## 故意不支持的场景

### 重复日历事件

重复日历事件带来很多复杂性，使软件和人类难以处理。这种复杂性包括邀请者之间的时区差异、夏令时、闰年、多个日历系统、时间表或其他元数据的一次性更改等。

本 NIP 故意省略对重复日历事件的支持，并将该复杂性推给客户端在需要时手动实现。即，具有重复元数据的单个日历事件表示重复日历事件。
