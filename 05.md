NIP-05
======

将 Nostr 密钥映射到基于 DNS 的互联网标识符
----------------------------------------------------

`最终` `可选`

在种类为 `0`（`用户元数据`）的事件中，可以指定键 `"nip05"`，其值为[互联网标识符](https://datatracker.ietf.org/doc/html/rfc5322#section-3.4.1)（类似电子邮件地址的地址）。虽然上面链接到了一个非常宽松的"互联网标识符"规范，但 NIP-05 假设 `<local-part>` 部分将限制为字符 `a-z0-9-_.`，不区分大小写。

看到这一点后，客户端将标识符分割为 `<local-part>` 和 `<domain>`，并使用这些值向 `https://<domain>/.well-known/nostr.json?name=<local-part>` 发出 GET 请求。

结果应该是一个 JSON 文档对象，具有键 `"names"`，然后应该是名称到十六进制格式公钥的映射。如果给定 `<name>` 的公钥与 `用户元数据` 事件中的 `pubkey` 匹配，客户端就会得出结论，给定的公钥确实可以通过其标识符引用。

### 示例

如果客户端看到这样的事件：

```jsonc
{
  "pubkey": "b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9",
  "kind": 0,
  "content": "{\"name\": \"bob\", \"nip05\": \"bob@example.com\"}"
  // 其他字段...
}
```

它将向 `https://example.com/.well-known/nostr.json?name=bob` 发出 GET 请求，并得到如下响应：

```json
{
  "names": {
    "bob": "b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9"
  }
}
```

或者带有**推荐的** `"relays"` 属性：

```json
{
  "names": {
    "bob": "b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9"
  },
  "relays": {
    "b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9": [ "wss://relay.example.com", "wss://relay2.example.com" ]
  }
}
```

如果公钥与 `"names"` 中给定的公钥匹配（如上例），这意味着关联是正确的，`"nip05"` 标识符有效且可以显示。

推荐的 `"relays"` 属性可能包含一个对象，公钥作为属性，中继器 URL 数组作为值。当存在时，这可以用来帮助客户端了解在哪些中继器中可以找到特定用户。基于查询字符串动态提供 `/.well-known/nostr.json` 文件的 Web 服务器在可用时也应该在同一响应中为它们提供的任何名称提供中继器数据。

## 从 NIP-05 标识符查找用户

客户端可以实现对从_互联网标识符_查找用户公钥的支持，流程与上面相同，但相反：首先客户端获取 _well-known_ URL，从中获取用户的公钥，然后尝试获取该用户的种类 `0` 事件并检查它是否有匹配的 `"nip05"`。

## 注意事项

### 标识，而非验证

NIP-05 不是为了_验证_用户，而只是为了_标识_他们，目的是促进联系人的交换或搜索。  
例外情况是拥有（例如，公司）或与知名域名相关联（例如，项目）的人，他们可以利用 NIP-05 作为他们与该域名关系的证明，从而与背后的组织的关系，从而获得信任元素。

### 用户发现实现建议

客户端可以使用这个功能允许用户搜索其他档案。如果客户端有搜索框或类似功能，用户可能能够在那里输入"bob@example.com"，客户端会识别这一点并执行适当的查询以获取公钥并向用户建议。

### 客户端必须始终关注公钥，而不是 NIP-05 地址

例如，如果在发现 `bob@bob.com` 具有公钥 `abc...def` 后，用户点击按钮关注该档案，客户端必须保持对 `abc...def` 的主要引用，而不是 `bob@bob.com`。如果由于任何原因，地址 `https://bob.com/.well-known/nostr.json?name=bob` 在将来的任何时候开始返回公钥 `1d2...e3f`，客户端不得在用户的关注档案列表中将 `abc...def` 替换为该用户（但它应该停止为该用户显示"bob@bob.com"，因为那将成为无效的 `"nip05"` 属性）。

### 公钥必须采用十六进制格式

密钥必须以十六进制格式返回。NIP-19 `npub` 格式的密钥仅用于在客户端 UI 中显示，不用于此 NIP。

### 仅显示域名作为标识符

客户端可以将标识符 `_@domain` 视为"根"标识符，并选择仅将其显示为 `<domain>`。例如，如果 Bob 拥有 `bob.com`，他可能不希望像 `bob@bob.com` 这样的标识符，因为那是多余的。相反，Bob 可以使用标识符 `_@bob.com` 并期望 Nostr 客户端在所有目的上显示并将其视为 `bob.com`。

### `/.well-known/nostr.json?name=<local-part>` 格式的原因

通过将 `<local-part>` 作为查询字符串而不是路径的一部分添加，该协议可以支持可以按需生成 JSON 的动态服务器和可能包含多个名称的 JSON 文件的静态服务器。

### 允许从 JavaScript 应用程序访问

JavaScript Nostr 应用程序可能受到浏览器 [CORS][] 策略的限制，这些策略阻止它们访问用户域上的 `/.well-known/nostr.json`。当 CORS 阻止 JS 加载资源时，JS 程序将其视为与资源不存在相同的网络故障，因此纯 JS 应用程序无法确定地告诉用户故障是由 CORS 问题引起的。看到请求 `/.well-known/nostr.json` 文件的网络故障的 JS Nostr 应用程序可能希望建议用户检查其服务器的 CORS 策略，例如：

```bash
$ curl -sI https://example.com/.well-known/nostr.json?name=bob | grep -i ^Access-Control
Access-Control-Allow-Origin: *
```

用户应确保他们的 `/.well-known/nostr.json` 使用 HTTP 头 `Access-Control-Allow-Origin: *` 提供，以确保它可以被在现代浏览器中运行的纯 JS 应用程序验证。

[CORS]: https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS

### 安全约束

`/.well-known/nostr.json` 端点不得返回任何 HTTP 重定向。

获取器必须忽略 `/.well-known/nostr.json` 端点给出的任何 HTTP 重定向。
